apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: LLMRoute
metadata:
  name: ratelimit-limits
  namespace: default
spec:
  targetRefs:
    - name: test-aig-ratelimit
      kind: Gateway
      group: gateway.networking.k8s.io
  backends:
    - backendRef:
        name: backend-ratelimit
        kind: Backend
        group: gateway.envoyproxy.io
      trafficPolicy:
        rateLimit:
          rules:
            - headers:
                - name: x-ai-gateway-llm-model-name
                  type: Exact
                  value: gpt-4o-mini
                - name: x-user-id
                  type: Distinct
              limits:
                - type: Request
                  quantity: 10
                  unit: Minute
                - type: Token
                  quantity: 500
                  unit: Minute
---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: backend-ratelimit
  namespace: default
spec:
  endpoints:
    - fqdn:
        hostname: testupstream.default.svc.cluster.local
        port: 80
